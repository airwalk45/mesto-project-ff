(()=>{"use strict";function e(e,t){var n=e.querySelector(".card__like-button");e.querySelector(".card__like-number").textContent=t.likes.length,n.classList.toggle("card__like-button_is-active")}function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}var r=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function a(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}var i=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){r(e,n,t),n.setCustomValidity("")})),a(n,o,t)},c="7e5bc3b7-9b3c-4476-a6ed-5dc02c289290",u="wff-cohort-10",l="https://mesto.nomoreparties.co",s=function(e){return e.ok?e.json():Promise.reject(e.status)},d=document.querySelector(".places__list"),p={item:"",removeCard:"",cardTemplate:document.querySelector("#card-template").content,addLikeToCard:"",zoomCardImg:function(e){var n=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption");n.src=e.target.src,n.alt=e.target.alt,o.textContent=e.target.alt,t(S)}},m=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__image"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_edit-avatar"),S=document.querySelector(".popup_type_image"),q=document.querySelectorAll(".popup"),g=document.querySelector('[name="edit-profile"]'),C=g.querySelector('[name="name"]'),L=g.querySelector('[name="description"]'),b=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),x=document.querySelector('[name="new-place"]'),T=x.querySelector('[name="place-name"]'),z=x.querySelector('[name="link"]'),w=document.querySelector('[name="new-avatar"]'),A=w.querySelector('[name="link"]'),B=document.querySelector(".popup_type_confirm"),D=B.querySelector('[name="delete-confirm"]'),j={},M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function P(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",r=arguments.length>2?arguments[2]:void 0;p.item=n,p.removeCard=function(){j._id=n._id,j.cardElement=a,t(B)},p.addLikeToCard=function(t){var o;t.target.classList.contains("card__like-button_is-active")?(o=n._id,fetch(l+"/v1/"+u+"/cards/likes/"+o,{method:"DELETE",headers:{authorization:c}}).then((function(e){s(e)}))).then((function(t){e(a,t)})).catch((function(e){console.log(e)})):function(e){return fetch(l+"/v1/"+u+"/cards/likes/"+e,{method:"put",headers:{authorization:c}}).then((function(e){s(e)}))}(n._id).then((function(t){e(a,t)})).catch((function(e){console.log(e)}))};var a=function(e,t){var n=e.cardTemplate.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__delete-button"),r=n.querySelector(".card__like-button"),a=n.querySelector(".card__image"),i=n.querySelector(".card__like-number"),c=n.querySelector(".card__title");return a.src=e.item.link,a.alt=e.item.name,c.textContent=e.item.name,i.textContent=e.item.likes.length,e.item.likes.some((function(e){return e._id===t}))&&r.classList.add("card__like-button_is-active"),r.addEventListener("click",e.addLikeToCard),a.addEventListener("click",e.zoomCardImg),e.item.owner._id===t?o.addEventListener("click",e.removeCard):o.remove(),n}(p,r);d[o](a)}function N(e){n(e.target.closest(".popup_is-opened"))}function O(e,t){t.target.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}function V(e,t){t.target.querySelector(".popup__button").textContent=e?"Удаляем...":"Да"}D.addEventListener("submit",(function(e){var t;e.preventDefault(),V(!0,e),(t=j._id,fetch(l+"/v1/"+u+"/cards/"+t,{method:"DELETE",headers:{authorization:c}}).then((function(e){s(e)}))).then((function(){j.cardElement.remove(),n(B)})).catch((function(e){console.log(e)})).finally((function(){V(!1,e)}))})),v.classList.add("popup_is-animated"),y.classList.add("popup_is-animated"),h.classList.add("popup_is-animated"),S.classList.add("popup_is-animated"),m.addEventListener("click",(function(){var e=v.querySelector(M.formSelector);i(e,M),t(v)})),_.addEventListener("click",(function(){var e=h.querySelector(M.formSelector);i(e,M),t(h)})),f.addEventListener("click",(function(){C.value=b.textContent,L.value=k.textContent;var e=y.querySelector(M.formSelector);i(e,M),t(y)})),q.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&n(e),t.target.classList.contains("popup__close")&&n(e)}))})),g.addEventListener("submit",(function(e){e.preventDefault();var t=C.value,n=L.value;b.textContent=t,k.textContent=n;var o={name:t,about:n};O(!0,e),function(e){return fetch(l+"/v1/"+u+"/users/me",{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){s(e)}))}(o).then((function(){N(e)})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)}))})),x.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:T.value,link:z.value};O(!0,e),(t=n,fetch(l+"/v1/"+u+"/cards",{method:"POST",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){s(e)}))).then((function(e){P(e,"prepend",e.owner._id)})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)})),x.reset(),N(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.validity.valueMissing?t.setCustomValidity(t.dataset.emptyMessage):t.setCustomValidity(""),t.validity.valid?r(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}(e,i,t),a(n,o,t)}))}))}(t,e)}))}(M),Promise.all([fetch(l+"/v1/"+u+"/users/me",{headers:{authorization:c}}).then((function(e){s(e)})),fetch(l+"/v1/"+u+"/cards",{headers:{authorization:c}}).then((function(e){s(e)}))]).then((function(e){var t;t=e[0],b.textContent=t.name,k.textContent=t.about,E.style="background-image: url("+t.avatar+")",e[1].forEach((function(t){P(t,"append",e[0]._id)}))})).catch((function(e){console.log(e)})),w.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e);var t=A.value;(function(e){return fetch(l+"/v1/"+u+"/users/me/avatar",{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){s(e)}))})(t).then((function(){E.style="background-image: url("+t+")"})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)})),w.reset(),N(e)}))})();
//# sourceMappingURL=main.js.map