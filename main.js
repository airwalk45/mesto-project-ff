(()=>{"use strict";function e(e,t){var n=e.querySelector(".card__like-button");e.querySelector(".card__like-number").textContent=t.likes.length,n.classList.toggle("card__like-button_is-active")}function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}var r=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function a(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}var i=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){r(e,n,t),n.setCustomValidity("")})),a(n,o,t)},c="7e5bc3b7-9b3c-4476-a6ed-5dc02c289290",u="wff-cohort-10",s="https://mesto.nomoreparties.co",l=document.querySelector(".places__list"),d={item:"",removeCard:"",cardTemplate:document.querySelector("#card-template").content,addLikeToCard:"",zoomCardImg:function(e){var n=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption");n.src=e.target.src,n.alt=e.target.alt,o.textContent=e.target.alt,t(h)}},p=document.querySelector(".profile__add-button"),m=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__image"),_=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_edit-avatar"),h=document.querySelector(".popup_type_image"),S=document.querySelectorAll(".popup"),q=document.querySelector('[name="edit-profile"]'),k=q.querySelector('[name="name"]'),g=q.querySelector('[name="description"]'),C=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),E=document.querySelector('[name="new-place"]'),j=E.querySelector('[name="place-name"]'),x=E.querySelector('[name="link"]'),T=document.querySelector('[name="new-avatar"]'),P=T.querySelector('[name="link"]'),z=document.querySelector(".popup_type_confirm"),w=z.querySelector('[name="delete-confirm"]'),A={},B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",r=arguments.length>2?arguments[2]:void 0;d.item=n,d.removeCard=function(){A._id=n._id,A.cardElement=a,t(z)},d.addLikeToCard=function(t){var o;t.target.classList.contains("card__like-button_is-active")?(o=n._id,fetch(s+"/v1/"+u+"/cards/likes/"+o,{method:"DELETE",headers:{authorization:c}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(t){e(a,t)})).catch((function(e){console.log(e)})):function(e){return fetch(s+"/v1/"+u+"/cards/likes/"+e,{method:"put",headers:{authorization:c}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(n._id).then((function(t){e(a,t)})).catch((function(e){console.log(e)}))};var a=function(e,t){var n=e.cardTemplate.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__delete-button"),r=n.querySelector(".card__like-button"),a=n.querySelector(".card__image"),i=n.querySelector(".card__like-number"),c=n.querySelector(".card__title");return a.src=e.item.link,a.alt=e.item.name,c.textContent=e.item.name,i.textContent=e.item.likes.length,e.item.likes.some((function(e){return e._id===t}))?r.classList.add("card__like-button_is-active"):r.classList.remove("card__like-button_is-active"),r.addEventListener("click",e.addLikeToCard),a.addEventListener("click",e.zoomCardImg),e.item.owner._id===t?o.addEventListener("click",e.removeCard):o.remove(),n}(d,r);l[o](a)}function M(e){n(e.target.closest(".popup_is-opened"))}function N(e,t){t.target.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}function O(e,t){t.target.querySelector(".popup__button").textContent=e?"Удаляем...":"Да"}w.addEventListener("submit",(function(e){var t;e.preventDefault(),O(!0,e),(t=A._id,fetch(s+"/v1/"+u+"/cards/"+t,{method:"DELETE",headers:{authorization:c}}).then((function(e){return e.ok?e:Promise.reject(e.status)}))).then((function(){A.cardElement.remove(),n(z)})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)}))})),_.classList.add("popup_is-animated"),v.classList.add("popup_is-animated"),y.classList.add("popup_is-animated"),h.classList.add("popup_is-animated"),p.addEventListener("click",(function(){var e=_.querySelector(B.formSelector);i(e,B),t(_)})),f.addEventListener("click",(function(){var e=y.querySelector(B.formSelector);i(e,B),t(y)})),m.addEventListener("click",(function(){k.value=C.textContent,g.value=L.textContent;var e=v.querySelector(B.formSelector);i(e,B),t(v)})),S.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&n(e),t.target.classList.contains("popup__close")&&n(e)}))})),q.addEventListener("submit",(function(e){e.preventDefault();var t=k.value,n=g.value;C.textContent=t,L.textContent=n;var o={name:t,about:n};N(!0,e),function(e){return fetch(s+"/v1/"+u+"/users/me",{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return e.ok?e:Promise.reject(e.status)}))}(o).then((function(){M(e)})).catch((function(e){console.log(e)})).finally((function(){N(!1,e)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:j.value,link:x.value};N(!0,e),(t=n,fetch(s+"/v1/"+u+"/cards",{method:"POST",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){D(e,"prepend",e.owner._id)})).catch((function(e){console.log(e)})).finally((function(){N(!1,e)})),E.reset(),M(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.validity.valueMissing?t.setCustomValidity(t.dataset.emptyMessage):t.setCustomValidity(""),t.validity.valid?r(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}(e,i,t),a(n,o,t)}))}))}(t,e)}))}(B),Promise.all([fetch(s+"/v1/"+u+"/users/me",{headers:{authorization:c}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})),fetch(s+"/v1/"+u+"/cards",{headers:{authorization:c}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))]).then((function(e){var t;t=e[0],C.textContent=t.name,L.textContent=t.about,b.style="background-image: url("+t.avatar+")",e[1].forEach((function(t){D(t,"append",e[0]._id)}))})).catch((function(e){console.log(e)})),T.addEventListener("submit",(function(e){e.preventDefault(),N(!0,e);var t=P.value;(function(e){return fetch(s+"/v1/"+u+"/users/me/avatar",{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e:Promise.reject(e.status)}))})(t).then((function(){b.style="background-image: url("+t+")"})).catch((function(e){console.log(e)})).finally((function(){N(!1,e)})),T.reset(),M(e)}))})();
//# sourceMappingURL=main.js.map